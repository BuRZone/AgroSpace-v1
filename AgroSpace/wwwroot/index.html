<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroSpace - –ö–∞—Ä—Ç–∞ –ø–æ–ª–µ–π</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.4.0/ol.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px 300px;
            gap: 20px;
            height: calc(100vh - 200px);
        }

        .map-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .sidebar, .fields-sidebar {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 20px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #667eea #f0f0f0;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è WebKit –±—Ä–∞—É–∑–µ—Ä–æ–≤ (Chrome, Safari, Edge) */
        .sidebar::-webkit-scrollbar, .fields-sidebar::-webkit-scrollbar {
            width: 8px;
            border-radius: 15px;
        }

        .sidebar::-webkit-scrollbar-track, .fields-sidebar::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 15px;
            margin: 5px;
        }

        .sidebar::-webkit-scrollbar-thumb, .fields-sidebar::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            border: 1px solid #f0f0f0;
        }

        .sidebar::-webkit-scrollbar-thumb:hover, .fields-sidebar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .field-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .field-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .field-item-highlighted {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%) !important;
            color: white !important;
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(255, 68, 68, 0.3);
            border-left: 4px solid #fff !important;
        }

        .field-item-highlighted .field-name {
            color: white !important;
        }

        .field-item-highlighted .field-size {
            color: rgba(255, 255, 255, 0.8) !important;
        }

        .field-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .field-size {
            color: #666;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .result {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 12px;
            padding: 10px;
            margin-top: 10px;
            font-size: 14px;
        }

        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
            border-radius: 12px;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .coordinates-display {
            background: #f0f8ff;
            border: 1px solid #2196f3;
            border-radius: 12px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥–ø–∏—Å–∏ OpenLayers */
        .ol-attribution {
            display: none !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞—Å—Ö–∞–ª–∫–∏ */
        .easter-egg-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 300px;
            animation: slideInRight 0.5s ease-out;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .easter-egg-notification.hide {
            animation: slideOutRight 0.5s ease-in forwards;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .easter-egg-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .easter-egg-coords {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            text-align: center;
        }

        .easter-egg-timer {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 0;
        }

        .easter-egg-clicks {
            text-align: center;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .easter-egg-polygon {
            position: absolute;
            pointer-events: none;
            z-index: 999;
        }

        .victory-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2000;
            animation: victoryPulse 2s ease-out;
        }

        @keyframes victoryPulse {
            0% {
                background: radial-gradient(circle, rgba(255,215,0,0.8) 0%, transparent 70%);
                transform: scale(0);
            }
            50% {
                background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, transparent 70%);
                transform: scale(1.2);
            }
            100% {
                background: radial-gradient(circle, rgba(255,215,0,0) 0%, transparent 70%);
                transform: scale(2);
            }
        }

        .victory-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 2001;
            animation: victoryText 2s ease-out;
        }

        @keyframes victoryText {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .click-result {
            position: fixed;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1500;
            pointer-events: none;
            animation: fadeInOut 2s ease-out;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –ø–∞—Å—Ö–∞–ª–∫–∏ */
        .easter-egg-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 999;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-width: 200px;
            display: none;
        }

        .easter-egg-controls.show {
            display: block;
            animation: slideInRight 0.3s ease-out;
        }

        .easter-egg-controls h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
            text-align: center;
        }

        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #ff6b6b;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .switch-label {
            font-size: 12px;
            color: #666;
        }

        .interval-settings {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            display: none;
        }

        .interval-settings.show {
            display: block;
        }

        .interval-input {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }

        .interval-input input {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
        }

        .interval-input label {
            font-size: 11px;
            color: #666;
        }



        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(20px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .sidebar {
                order: -1;
            }

            .easter-egg-notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåæ AgroSpace</h1>
            <p>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å–µ–ª—å—Å–∫–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π</p>
            <!-- <button id="test-easter-egg" class="btn" style="margin-top: 10px; width: auto; padding: 8px 16px; font-size: 12px; background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);">
                üéØ –¢–µ—Å—Ç –ø–∞—Å—Ö–∞–ª–∫–∏
            </button> -->
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–∞—Å—Ö–∞–ª–∫–∏ -->
        <div id="easter-egg-notification" class="easter-egg-notification" style="display: none;">
            <div class="easter-egg-title">üéØ –ü–∞—Å—Ö–∞–ª–∫–∞!</div>
            <div class="easter-egg-coords" id="easter-egg-coords"></div>
            <div class="easter-egg-timer" id="easter-egg-timer">01:00</div>
            <div class="easter-egg-clicks" id="easter-egg-clicks">–ö–ª–∏–∫–æ–≤: 0/5</div>
            <div style="text-align: center; font-size: 12px; opacity: 0.8;">
                –ü–æ–ø–∞–¥–∏—Ç–µ –≤ –æ–±–ª–∞—Å—Ç—å –∑–∞ 5 –∫–ª–∏–∫–æ–≤!
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Å—Ö–∞–ª–∫–æ–π -->
        <div id="easter-egg-controls" class="easter-egg-controls">
            <h4>üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Å—Ö–∞–ª–∫–æ–π</h4>
            <div class="switch-container">
                <span class="switch-label">–í–∫–ª—é—á–∏—Ç—å –ø–∞—Å—Ö–∞–ª–∫—É</span>
                <label class="switch">
                    <input type="checkbox" id="easter-egg-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div id="interval-settings" class="interval-settings">
                <div class="interval-input">
                    <input type="number" id="interval-minutes" min="1" max="60" value="5">
                    <label for="interval-minutes">–º–∏–Ω—É—Ç</label>
                </div>
                <div class="interval-input">
                    <input type="number" id="interval-seconds" min="0" max="59" value="0">
                    <label for="interval-seconds">—Å–µ–∫—É–Ω–¥</label>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
            </div>

            <div class="sidebar">
                <div class="section">
                    <h3>üìç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–∫–∏</h3>
                    <form id="point-form">
                        <div class="form-group">
                            <label for="lat">–®–∏—Ä–æ—Ç–∞:</label>
                            <input type="number" id="lat" step="any" placeholder="41.3380610642585" required>
                        </div>
                        <div class="form-group">
                            <label for="lng">–î–æ–ª–≥–æ—Ç–∞:</label>
                            <input type="number" id="lng" step="any" placeholder="45.6962567581079" required>
                        </div>
                        <button type="submit" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å</button>
                    </form>
                    <div id="point-result"></div>
                </div>

                <div class="section">
                    <h3>üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–∞</h3>
                    <form id="distance-form">
                        <div class="form-group">
                            <label for="field-id">ID –ø–æ–ª—è:</label>
                            <input type="number" id="field-id" placeholder="1" required min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="distance-lat">–®–∏—Ä–æ—Ç–∞:</label>
                            <input type="number" id="distance-lat" step="any" placeholder="41.3380610642585" required>
                        </div>
                        <div class="form-group">
                            <label for="distance-lng">–î–æ–ª–≥–æ—Ç–∞:</label>
                            <input type="number" id="distance-lng" step="any" placeholder="45.6962567581079" required>
                        </div>
                        <button type="submit" class="btn">–í—ã—á–∏—Å–ª–∏—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ</button>
                    </form>
                    <div id="distance-result"></div>
                </div>

                <div class="section">
                    <h3>üéØ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞</h3>
                    <div id="click-coordinates" class="coordinates-display">
                        –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                    </div>
                </div>
            </div>

            <div class="fields-sidebar">
                <div class="section">
                    <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—è—Ö</h3>
                    <div id="fields-info">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ol@v7.4.0/dist/ol.js"></script>
    <script>
        let map;
        let fields = [];
        let fieldPolygons = [];
        let fieldMarkers = [];
        let clickMarkerLayer = null;
        let distanceLabelLayer = null;
        let distanceLineLayer = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            map = new ol.Map({
                target: 'map',
                layers: [
                    new ol.layer.Tile({
                        source: new ol.source.OSM({
                            attributions: [] // –£–±–∏—Ä–∞–µ–º –ø–æ–¥–ø–∏—Å–∏
                        })
                    })
                ],
                view: new ol.View({
                    center: ol.proj.fromLonLat([41.3380610642585, 45.6962567581079]),
                    zoom: 13
                })
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
            map.on('click', function(e) {
                const coords = ol.proj.toLonLat(e.coordinate);
                const lat = coords[1].toFixed(12);
                const lng = coords[0].toFixed(12);
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–∞—Å—Ö–∞–ª–∫—É
                handleEasterEggClick(parseFloat(lat), parseFloat(lng));
                
                document.getElementById('click-coordinates').innerHTML = 
                    `–®–∏—Ä–æ—Ç–∞: ${lat}<br>–î–æ–ª–≥–æ—Ç–∞: ${lng}`;
                
                // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º
                document.getElementById('lat').value = lat;
                document.getElementById('lng').value = lng;
                document.getElementById('distance-lat').value = lat;
                document.getElementById('distance-lng').value = lng;

                // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ —Ç–æ—á–∫–∏
                document.getElementById('distance-result').innerHTML = '';
                // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ —Ç–æ—á–∫–∏
                document.getElementById('point-result').innerHTML = '';

                // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–∞—Ä–∫–µ—Ä, –µ—Å–ª–∏ –±—ã–ª
                if (clickMarkerLayer) {
                    map.removeLayer(clickMarkerLayer);
                }
                
                // –£–¥–∞–ª—è–µ–º –ø–æ–¥–ø–∏—Å—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∏ –ª–∏–Ω–∏—é, –µ—Å–ª–∏ –±—ã–ª–∏
                if (distanceLabelLayer) {
                    map.removeLayer(distanceLabelLayer);
                    distanceLabelLayer = null;
                }
                if (distanceLineLayer) {
                    map.removeLayer(distanceLineLayer);
                    distanceLineLayer = null;
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø–æ–ª—è –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ —Ç–æ—á–∫–∏
                clearFieldListHighlight();
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä
                clickMarkerLayer = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: [
                            new ol.Feature({
                                geometry: new ol.geom.Point(e.coordinate)
                            })
                        ]
                    }),
                    style: new ol.style.Style({
                        image: new ol.style.Circle({
                            radius: 7,
                            fill: new ol.style.Fill({ color: '#2196f3' }),
                            stroke: new ol.style.Stroke({ color: '#fff', width: 2 })
                        })
                    })
                });
                map.addLayer(clickMarkerLayer);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—è—Ö
        async function loadFields() {
            try {
                const response = await fetch('/api/fields');
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                
                fields = await response.json();
                displayFieldsInfo();
                displayFieldsOnMap();
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –ø–µ—Ä–≤–æ–º –ø–æ–ª–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                if (fields.length > 0) {
                    const firstField = fields[0];
                    map.getView().setCenter(
                        ol.proj.fromLonLat([firstField.locations.center.lng, firstField.locations.center.lat])
                    );
                    map.getView().setZoom(13);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª–µ–π:', error);
                document.getElementById('fields-info').innerHTML = 
                    '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—è—Ö</div>';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—è—Ö
        function displayFieldsInfo() {
            const container = document.getElementById('fields-info');
            container.innerHTML = fields.map(field => `
                <div class="field-item" data-field-id="${field.id}" onclick="highlightField(${field.id})">
                    <div class="field-name">${field.name}</div>
                    <div class="field-size">–ü–ª–æ—â–∞–¥—å: ${field.size} –≥–∞</div>
                </div>
            `).join('');
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–µ–π –Ω–∞ –∫–∞—Ä—Ç–µ
        function displayFieldsOnMap() {
            // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            fieldPolygons.forEach(polygon => map.removeLayer(polygon));
            fieldMarkers.forEach(marker => map.removeLayer(marker));
            fieldPolygons = [];
            fieldMarkers = [];

            fields.forEach(field => {
                // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–∞
                const polygonCoords = field.locations.polygon.map(coord => 
                    ol.proj.fromLonLat([coord.lng, coord.lat])
                );
                
                const polygon = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: [
                            new ol.Feature({
                                geometry: new ol.geom.Polygon([polygonCoords])
                            })
                        ]
                    }),
                    style: new ol.style.Style({
                        stroke: new ol.style.Stroke({
                            color: '#667eea',
                            width: 2
                        }),
                        fill: new ol.style.Fill({
                            color: 'rgba(102, 126, 234, 0.2)'
                        })
                    })
                });

                map.addLayer(polygon);
                fieldPolygons.push(polygon);

                // –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ —Ü–µ–Ω—Ç—Ä–∞ —Å –ø–æ–¥–ø–∏—Å—å—é
                const marker = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: [
                            new ol.Feature({
                                geometry: new ol.geom.Point(
                                    ol.proj.fromLonLat([field.locations.center.lng, field.locations.center.lat])
                                ),
                                name: field.name,
                                size: field.size
                            })
                        ]
                    }),
                    style: function(feature) {
                        return [
                            new ol.style.Style({
                                image: new ol.style.Circle({
                                    radius: 6,
                                    fill: new ol.style.Fill({
                                        color: '#ff4444'
                                    }),
                                    stroke: new ol.style.Stroke({
                                        color: 'white',
                                        width: 2
                                    })
                                })
                            }),
                            new ol.style.Style({
                                geometry: function(feature) {
                                    const geometry = feature.getGeometry();
                                    const extent = geometry.getExtent();
                                    const center = ol.extent.getCenter(extent);
                                    const offset = [0, -20]; // –°–º–µ—â–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤—ã—à–µ –º–∞—Ä–∫–µ—Ä–∞
                                    return new ol.geom.Point([center[0] + offset[0], center[1] + offset[1]]);
                                },
                                text: new ol.style.Text({
                                    text: `${feature.get('name')}\n${feature.get('size')} –≥–∞`,
                                    font: '12px Arial',
                                    fill: new ol.style.Fill({
                                        color: '#333'
                                    }),
                                    stroke: new ol.style.Stroke({
                                        color: 'white',
                                        width: 3
                                    }),
                                    textAlign: 'center',
                                    offsetY: -10
                                })
                            })
                        ];
                    }
                });

                map.addLayer(marker);
                fieldMarkers.push(marker);
            });
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ–ª—è
        function highlightField(fieldId) {
            const field = fields.find(f => f.id === fieldId);
            if (field) {
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –ø–æ–ª–µ
                map.getView().setCenter(
                    ol.proj.fromLonLat([field.locations.center.lng, field.locations.center.lat])
                );
                
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ø–æ–ª–µ
                highlightSelectedField(fieldId);
            }
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è
        function highlightSelectedField(fieldId) {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è –∫ –æ–±—ã—á–Ω–æ–º—É —Å—Ç–∏–ª—é
            fieldPolygons.forEach((polygon, index) => {
                const field = fields[index];
                if (field) {
                    polygon.setStyle(new ol.style.Style({
                        stroke: new ol.style.Stroke({
                            color: fieldId && field.id === fieldId ? '#ff4444' : '#667eea',
                            width: fieldId && field.id === fieldId ? 4 : 2
                        }),
                        fill: new ol.style.Fill({
                            color: fieldId && field.id === fieldId ? 'rgba(255, 68, 68, 0.3)' : 'rgba(102, 126, 234, 0.2)'
                        })
                    }));
                }
            });
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ–ª—è –≤ —Å–ø–∏—Å–∫–µ –∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–µ–º—É
        function highlightFieldInList(fieldId) {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É
            clearFieldListHighlight();
            
            // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ–ª—è –≤ —Å–ø–∏—Å–∫–µ
            const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
            if (fieldElement) {
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –ø–æ–¥—Å–≤–µ—Ç–∫–∏
                fieldElement.classList.add('field-item-highlighted');
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                fieldElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }
        }

        // –°–±—Ä–æ—Å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤ —Å–ø–∏—Å–∫–µ
        function clearFieldListHighlight() {
            const highlightedElements = document.querySelectorAll('.field-item-highlighted');
            highlightedElements.forEach(element => {
                element.classList.remove('field-item-highlighted');
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ —Ç–æ—á–∫–∏
        async function checkPointLocation(lat, lng) {
            try {
                const response = await fetch('/api/fields/point-location', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ lat, lng })
                });

                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞');
                
                const result = await response.json();
                const resultDiv = document.getElementById('point-result');
                
                if (result === false) {
                    resultDiv.innerHTML = '<div class="result">–¢–æ—á–∫–∞ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–∏ –æ–¥–Ω–æ–º—É –ø–æ–ª—é</div>';
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –≤—Å–µ—Ö –ø–æ–ª–µ–π
                    highlightSelectedField(null);
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –≤ —Å–ø–∏—Å–∫–µ
                    clearFieldListHighlight();
                } else {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <strong>–¢–æ—á–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–æ–ª–µ:</strong><br>
                            ID: ${result.id}<br>
                            –ù–∞–∑–≤–∞–Ω–∏–µ: ${result.name}
                        </div>
                    `;
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø–æ–ª–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–æ—á–∫–∞
                    highlightSelectedField(result.id);
                    
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø–æ–ª–µ –≤ —Å–ø–∏—Å–∫–µ –∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–µ–º—É
                    highlightFieldInList(result.id);
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º ID –ø–æ–ª—è –≤ —Ñ–æ—Ä–º—É —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
                    document.getElementById('field-id').value = result.id;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ—á–∫–∏:', error);
                document.getElementById('point-result').innerHTML = 
                    '<div class="error">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ—á–∫–∏</div>';
            }
        }

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
        async function calculateDistance(fieldId, lat, lng) {
            try {
                const response = await fetch('/api/fields/distance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ fieldId, lat, lng })
                });

                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞');
                
                const distance = await response.json();
                const resultDiv = document.getElementById('distance-result');
                
                resultDiv.innerHTML = `
                    <div class="result">
                        <strong>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ:</strong> ${distance.toFixed(2)} –º–µ—Ç—Ä–æ–≤
                    </div>
                `;

                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ø–æ–ª–µ
                highlightSelectedField(fieldId);

                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—å –∫ –º–∞—Ä–∫–µ—Ä—É —Ç–æ—á–∫–∏
                addDistanceLabelToMarker(lat, lng, distance, fieldId);
                
                // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –ø–æ–ª—è
                drawDistanceLine(lat, lng, fieldId);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è:', error);
                document.getElementById('distance-result').innerHTML = 
                    '<div class="error">–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è</div>';
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ –∫ –º–∞—Ä–∫–µ—Ä—É —Ç–æ—á–∫–∏
        function addDistanceLabelToMarker(lat, lng, distance, fieldId) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–¥–ø–∏—Å—å, –µ—Å–ª–∏ –±—ã–ª–∞
            if (distanceLabelLayer) {
                map.removeLayer(distanceLabelLayer);
            }

            const field = fields.find(f => f.id === fieldId);
            if (!field) return;

            distanceLabelLayer = new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: [
                        new ol.Feature({
                            geometry: new ol.geom.Point(ol.proj.fromLonLat([lng, lat]))
                        })
                    ]
                }),
                style: new ol.style.Style({
                    text: new ol.style.Text({
                        text: `${distance.toFixed(1)} –º`,
                        font: 'bold 12px Arial',
                        fill: new ol.style.Fill({
                            color: '#333'
                        }),
                        stroke: new ol.style.Stroke({
                            color: 'white',
                            width: 3
                        }),
                        offsetY: -25,
                        textAlign: 'center'
                    })
                })
            });

            map.addLayer(distanceLabelLayer);
        }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –ª–∏–Ω–∏–∏ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –ø–æ–ª—è
        function drawDistanceLine(lat, lng, fieldId) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ª–∏–Ω–∏—é, –µ—Å–ª–∏ –±—ã–ª–∞
            if (distanceLineLayer) {
                map.removeLayer(distanceLineLayer);
            }

            const field = fields.find(f => f.id === fieldId);
            if (!field) return;

            const startPoint = ol.proj.fromLonLat([lng, lat]);
            const endPoint = ol.proj.fromLonLat([field.locations.center.lng, field.locations.center.lat]);

            distanceLineLayer = new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: [
                        new ol.Feature({
                            geometry: new ol.geom.LineString([startPoint, endPoint])
                        })
                    ]
                }),
                style: new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: '#ff4444',
                        width: 2,
                        lineDash: [5, 5]
                    })
                })
            });

            map.addLayer(distanceLineLayer);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º
        document.getElementById('point-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const lat = parseFloat(document.getElementById('lat').value);
            const lng = parseFloat(document.getElementById('lng').value);
            checkPointLocation(lat, lng);
        });

        document.getElementById('distance-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const fieldId = parseInt(document.getElementById('field-id').value);
            const lat = parseFloat(document.getElementById('distance-lat').value);
            const lng = parseFloat(document.getElementById('distance-lng').value);
            calculateDistance(fieldId, lat, lng);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è ID –ø–æ–ª—è –≤ —Ñ–æ—Ä–º–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
        document.getElementById('field-id').addEventListener('change', function(e) {
            const fieldId = parseInt(e.target.value);
            if (fieldId > 0) {
                highlightSelectedField(fieldId);
            }
        });

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–∞—Å—Ö–∞–ª–∫–∏
        let easterEggActive = false;
        let easterEggPolygon = null;
        let easterEggCenter = null;
        let easterEggClickCount = 0;
        let easterEggTimer = null;
        let easterEggTimeLeft = 60; // 60 —Å–µ–∫—É–Ω–¥
        let easterEggInterval = null;
        let easterEggEnabled = true;
        let easterEggIntervalMs = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let easterEggMainTimer = null;
        let easterEggControlsShown = false;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ –≤—Å–µ–π –∫–∞—Ä—Ç–µ
        function generateRandomCoordinates() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ –≤—Å–µ–π –∫–∞—Ä—Ç–µ
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑—É–º–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ó–µ–º–ª–∏
            const minLon = -180; // –ó–∞–ø–∞–¥–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
            const maxLon = 180;  // –í–æ—Å—Ç–æ—á–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
            const minLat = -85;  // –Æ–∂–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ (–∏—Å–∫–ª—é—á–∞–µ–º –ø–æ–ª—é—Å–∞)
            const maxLat = 85;   // –°–µ–≤–µ—Ä–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ (–∏—Å–∫–ª—é—á–∞–µ–º –ø–æ–ª—é—Å–∞)
            
            const centerLon = minLon + Math.random() * (maxLon - minLon);
            const centerLat = minLat + Math.random() * (maxLat - minLat);
            
            return { lng: centerLon, lat: centerLat };
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–∞ –≤–æ–∫—Ä—É–≥ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–∏
        function createEasterEggPolygon(center) {
            const radius = 0.005; // –†–∞–¥–∏—É—Å –ø–æ–ª–∏–≥–æ–Ω–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö (–ø—Ä–∏–º–µ—Ä–Ω–æ 500 –º–µ—Ç—Ä–æ–≤)
            const points = [];
            
            for (let i = 0; i < 8; i++) {
                const angle = (i * Math.PI * 2) / 8;
                const lat = center.lat + radius * Math.cos(angle);
                const lng = center.lng + radius * Math.sin(angle);
                points.push([lng, lat]);
            }
            
            return points;
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–∞—Å—Ö–∞–ª–∫–∏
        function showEasterEggNotification() {
            if (easterEggActive) return;
            
            easterEggActive = true;
            easterEggClickCount = 0;
            easterEggTimeLeft = 60;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—è–≤–ª–µ–Ω–∏–∏ –ø–∞—Å—Ö–∞–ª–∫–∏
            if (!easterEggControlsShown) {
                setTimeout(() => {
                    showEasterEggControls();
                }, 2000); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–∞—Å—Ö–∞–ª–∫–∏
            }
            

            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            easterEggCenter = generateRandomCoordinates();
            console.log('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–∞—Å—Ö–∞–ª–∫–∏:', easterEggCenter);
            const polygonCoords = createEasterEggPolygon(easterEggCenter);
            
            // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–∏–≥–æ–Ω –Ω–∞ –∫–∞—Ä—Ç–µ
            easterEggPolygon = new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: [
                        new ol.Feature({
                            geometry: new ol.geom.Polygon([polygonCoords.map(coord => 
                                ol.proj.fromLonLat(coord)
                            )])
                        })
                    ]
                }),
                style: new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: '#ff6b6b',
                        width: 3,
                        lineDash: [10, 5]
                    }),
                    fill: new ol.style.Fill({
                        color: 'rgba(255, 107, 107, 0.1)'
                    })
                })
            });
            
            map.addLayer(easterEggPolygon);
            

            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.getElementById('easter-egg-notification');
            document.getElementById('easter-egg-coords').textContent = 
                `–¶–µ–Ω—Ç—Ä: ${easterEggCenter.lat.toFixed(6)}, ${easterEggCenter.lng.toFixed(6)}`;
            document.getElementById('easter-egg-clicks').textContent = '–ö–ª–∏–∫–æ–≤: 0/5';
            notification.style.display = 'block';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            easterEggInterval = setInterval(updateEasterEggTimer, 1000);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥
            easterEggTimer = setTimeout(() => {
                hideEasterEggNotification();
            }, 60000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –ø–∞—Å—Ö–∞–ª–∫–∏
        function updateEasterEggTimer() {
            easterEggTimeLeft--;
            const minutes = Math.floor(easterEggTimeLeft / 60);
            const seconds = easterEggTimeLeft % 60;
            document.getElementById('easter-egg-timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (easterEggTimeLeft <= 0) {
                hideEasterEggNotification();
            }
        }

        // –°–∫—Ä—ã—Ç–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–∞—Å—Ö–∞–ª–∫–∏
        function hideEasterEggNotification() {
            easterEggActive = false;
            
            if (easterEggPolygon) {
                map.removeLayer(easterEggPolygon);
                easterEggPolygon = null;
            }
            
            if (easterEggInterval) {
                clearInterval(easterEggInterval);
                easterEggInterval = null;
            }
            
            if (easterEggTimer) {
                clearTimeout(easterEggTimer);
                easterEggTimer = null;
            }
            

            
            const notification = document.getElementById('easter-egg-notification');
            notification.classList.add('hide');
            setTimeout(() => {
                notification.style.display = 'none';
                notification.classList.remove('hide');
            }, 500);
            
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–π–º–µ—Ä –ø–∞—Å—Ö–∞–ª–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
            if (easterEggEnabled) {
                startEasterEggTimer();
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –ø–æ–ª–∏–≥–æ–Ω –ø–∞—Å—Ö–∞–ª–∫–∏
        function checkEasterEggHit(lat, lng) {
            if (!easterEggActive || !easterEggPolygon) return false;
            
            const point = new ol.geom.Point(ol.proj.fromLonLat([lng, lat]));
            const polygon = easterEggPolygon.getSource().getFeatures()[0].getGeometry();
            
            return polygon.intersectsCoordinate(point.getCoordinates());
        }

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –ø–∞—Å—Ö–∞–ª–∫–∏
        function calculateDistanceToEasterEggCenter(lat, lng) {
            if (!easterEggCenter) return 0;
            
            const R = 6371000; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
            const lat1 = lat * Math.PI / 180;
            const lat2 = easterEggCenter.lat * Math.PI / 180;
            const deltaLat = (easterEggCenter.lat - lat) * Math.PI / 180;
            const deltaLng = (easterEggCenter.lng - lng) * Math.PI / 180;
            
            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +
                     Math.cos(lat1) * Math.cos(lat2) *
                     Math.sin(deltaLng / 2) * Math.sin(deltaLng / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            
            return R * c;
        }

        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–ª–∏–∫–∞
        function showClickResult(lat, lng, distance, hit) {
            const result = document.createElement('div');
            result.className = 'click-result';
            result.style.left = event.clientX + 'px';
            result.style.top = event.clientY + 'px';
            
            if (hit) {
                result.textContent = `üéØ –ü–æ–ø–∞–¥–∞–Ω–∏–µ! –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance.toFixed(1)}–º`;
                result.style.color = '#4caf50';
            } else {
                result.textContent = `‚ùå –ü—Ä–æ–º–∞—Ö! –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance.toFixed(1)}–º`;
                result.style.color = '#f44336';
            }
            
            document.body.appendChild(result);
            
            setTimeout(() => {
                document.body.removeChild(result);
            }, 2000);
        }

        // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–±–µ–¥—ã
        function showVictoryEffect() {
            // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü–∏–∏
            const effect = document.createElement('div');
            effect.className = 'victory-effect';
            document.body.appendChild(effect);
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ–±–µ–¥—ã
            const victoryText = document.createElement('div');
            victoryText.className = 'victory-text';
            victoryText.textContent = 'üéâ –ü–û–ë–ï–î–ê! üéâ';
            document.body.appendChild(victoryText);
            
            // –£–¥–∞–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                document.body.removeChild(effect);
                document.body.removeChild(victoryText);
            }, 2000);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ –¥–ª—è –ø–∞—Å—Ö–∞–ª–∫–∏
        function handleEasterEggClick(lat, lng) {
            if (!easterEggActive) return;
            
            easterEggClickCount++;
            document.getElementById('easter-egg-clicks').textContent = `–ö–ª–∏–∫–æ–≤: ${easterEggClickCount}/5`;
            
            const distance = calculateDistanceToEasterEggCenter(lat, lng);
            const hit = checkEasterEggHit(lat, lng);
            
            console.log('–ö–ª–∏–∫ –ø–∞—Å—Ö–∞–ª–∫–∏:', { lat, lng, distance, hit, center: easterEggCenter });
            
            showClickResult(lat, lng, distance, hit);
            
            if (hit) {
                showVictoryEffect();
                hideEasterEggNotification();
            } else if (easterEggClickCount >= 5) {
                hideEasterEggNotification();
            }
        }



        // –ó–∞–ø—É—Å–∫ –ø–∞—Å—Ö–∞–ª–∫–∏ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
        function startEasterEggTimer() {
            if (easterEggMainTimer) {
                clearInterval(easterEggMainTimer);
            }
            
            easterEggMainTimer = setInterval(() => {
                if (easterEggEnabled) {
                    showEasterEggNotification();
                }
            }, easterEggIntervalMs);
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ –ø–∞—Å—Ö–∞–ª–∫–∏
        function stopEasterEggTimer() {
            if (easterEggMainTimer) {
                clearInterval(easterEggMainTimer);
                easterEggMainTimer = null;
            }
        }

        // –ü–æ–∫–∞–∑ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Å—Ö–∞–ª–∫–æ–π
        function showEasterEggControls() {
            const controls = document.getElementById('easter-egg-controls');
            controls.classList.add('show');
            easterEggControlsShown = true;
        }



        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø–∞—Å—Ö–∞–ª–∫–∏
        function updateEasterEggInterval() {
            const minutes = parseInt(document.getElementById('interval-minutes').value) || 0;
            const seconds = parseInt(document.getElementById('interval-seconds').value) || 0;
            
            easterEggIntervalMs = (minutes * 60 + seconds) * 1000;
            
            if (easterEggEnabled) {
                startEasterEggTimer();
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∞—Å—Ö–∞–ª–∫–∏
        function toggleEasterEgg(enabled) {
            easterEggEnabled = enabled;
            
            if (enabled) {
                startEasterEggTimer();
            } else {
                stopEasterEggTimer();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–∞—Å—Ö–∞–ª–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Å—Ö–∞–ª–∫–∏
            const testButton = document.getElementById('test-easter-egg');
            if (testButton) {
                testButton.addEventListener('click', function() {
                    if (!easterEggActive) {
                        showEasterEggNotification();
                    }
                });
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –ø–∞—Å—Ö–∞–ª–∫–∏
            const toggleSwitch = document.getElementById('easter-egg-toggle');
            if (toggleSwitch) {
                toggleSwitch.addEventListener('change', function() {
                    toggleEasterEgg(this.checked);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
                    const intervalSettings = document.getElementById('interval-settings');
                    if (this.checked) {
                        intervalSettings.classList.add('show');
                    } else {
                        intervalSettings.classList.remove('show');
                    }
                });
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª–µ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
            const intervalMinutes = document.getElementById('interval-minutes');
            const intervalSeconds = document.getElementById('interval-seconds');
            
            if (intervalMinutes) {
                intervalMinutes.addEventListener('change', updateEasterEggInterval);
            }
            if (intervalSeconds) {
                intervalSeconds.addEventListener('change', updateEasterEggInterval);
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
            const intervalSettings = document.getElementById('interval-settings');
            if (intervalSettings) {
                intervalSettings.classList.add('show');
            }

            // –£–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ—ë
            // –ü–∞–Ω–µ–ª—å –±—É–¥–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è


        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            loadFields();
            startEasterEggTimer();
        });
    </script>
</body>
</html> 